evil_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 30
	hostile_against_others = yes
	is_permanent = yes
    allow_distant = yes
    allow_whitepeace = no
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	
	can_use = {
		FROM = {
			NOT = { religion = religion_wilderness } 
		}
	}
	
	can_use_gui = {
		custom_tooltip = {
			text = broken_siege_of_angband_tip
			hidden_tooltip = {
				OR = {
					ROOT = {
						top_liege = { NOT = { has_character_flag = morgoth } }
					}
					has_global_flag = broken_siege_of_angband # morgoth can't launch invasions until after the bragollach
				}
			}
		}
		ROOT = {
			prestige = 120
			OR = {
				religion_group=religion_group_melkor
				trait = evil_side
			}
		}
		FROM = {
			NOT = { trait = evil_side }
			NOT = { religion_group = religion_group_melkor } # Should subjugate these instead
			independent = yes
		}
	}
	
	on_add = {
		ROOT = { 
			prestige = -100 
			wealth = 50
			piety = 100
		}
	}

	can_use_title = {
		NOT = {
				is_hidden_realm = yes
			}
		ROOT = {
			OR = {
				AND = {
					OR = {
						religion_group=religion_group_melkor
						trait = evil_side
					}
					FROM = {
						NOT = { religion_group = religion_group_melkor } # Should subjugate these instead		
					}
				}
				
				AND = {
					mercenary = yes
					NOT = {
						num_of_titles = 2
					}
				}
			}
		}
		
		ROOT = {
			NOT = { is_liege_or_above = FROM }
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 200
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -200
			
			# destroy all occupied provinces
			any_realm_province = {
				if = {
					limit = { controlled_by = ROOT }
					province_event = { id = evilside.5 }
				}
			}
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
		}
	}
	
	on_success_title = {
	
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						same_religion = yes # Only vassalize rulers of my religion
					}
				}			
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
		}
		FROM = {
			prestige = 200
			piety = 200
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		hidden_tooltip = {
			FROM = {
				occupy_minors_of_occupied_settlements = ROOT
				gain_all_occupied_titles = ROOT
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 99
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 99
	}
	ai_will_do = { 
		factor = 100
	}	
}
#### Good Invasion


good_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 30
	hostile_against_others = no
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = DUKE # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	can_use = {
		FROM = { 
			NOT = { religion = religion_wilderness } 
		}
	}
	
	can_use_gui = {
		ROOT = {
			prestige = 120
			OR = {
				trait = good_side
				religion_group = religion_group_khazad 
				religion_group = religion_group_eldar
				religion_group = religion_group_periannath 	
				religion_group = religion_group_edain 
            }
		}
		FROM = {
			OR = {
				religion_group=religion_group_melkor
				trait = evil_side
			}
			hidden_tooltip = {
				OR = {
					is_tribal = no
					higher_tier_than = DUKE
					ROOT = { ai = no }
				}
			}
			independent = yes
		}
	}

	on_add = {
		ROOT = {
			prestige = -100 
			wealth = 250
		}
	}

	can_use_title = {
		NOT = {
			is_hidden_realm = yes
		}
		ROOT = {
			OR = {
				AND = {
					OR =  {
						religion_group = religion_group_khazad 
						religion_group = religion_group_eldar 	
						religion_group = religion_group_periannath 	
						religion_group = religion_group_edain
						trait = good_side
					}
					
					higher_tier_than = COUNT
					FROM = {
						OR = {
							religion_group=religion_group_melkor
							trait = evil_side
						}
					}
				}
				
				AND = {
					mercenary = yes
					NOT = {
						num_of_titles = 2
					}
				}
			}
		}
		
		ROOT = {
			NOT = { is_liege_or_above = FROM }
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 200
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -200
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
		}
	}
	
	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						same_religion = yes # Only vassalize rulers of my religion
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			prestige = 200
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		ROOT = {			
			# destroy all occupied provinces
			any_realm_province = {
				if = {
					limit = { controlled_by = FROM }
					province_event = { id = evilside.5 }
				}
			}
		}
		hidden_tooltip = {
			FROM = {
				occupy_minors_of_occupied_settlements = ROOT
				gain_all_occupied_titles = ROOT
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 50
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 99
	}
	ai_will_do = { 
		factor = 100
	}	
}


nomad_resettle_wilderness = { # TODO: abandon all currently occupied counties, not just the capital
	name = CB_NAME_NOMAD_WILDERNESS
	war_name = WAR_NAME_NOMAD_WILDERNESS
	sprite = 9
	truce_days = 1825
	is_permanent = yes
#	check_de_jure_tier = COUNT # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	apply_short_occ_mod = no
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
#	press_claim = yes
	can_ask_to_join_war = no
	allow_distant = yes

	can_use_gui = {
		ROOT = {
			prestige = 100
		}
	}
	on_add = {
		ROOT = {
			prestige = -100
		}
	}
	
	can_use = {
		ROOT = {
			government = nomadic_government
		}
		FROM = {
			religion_group = religion_group_wilderness
		}
		OR = { # player can do what we want, but the AI should follow encampment sites we set out for them
			ROOT = { ai = no }
			FROM = { has_character_flag = settle_me }
		}
		NOT = { # player might be restricted from resettling
			ROOT = { has_character_flag = no_settling }
		}
	}

	can_use_title = {
		tier = COUNT
	}
	
	is_valid = {
		always = yes
	}
	
	on_success = {
		FROM = { clr_character_flag = settle_me }
	}

	on_success_title = {
	
		#ROOT = {
		#	# abandon any lands without holdings TODO: with holdings as well, they become ruins and you get a little gold
		#	any_demesne_province = {
		#		limit = {
		#			num_of_settlements = 0
		#		}
		#		create_character = {
		#		  random_traits = no
		#		  name = "Wilderness"
		#		  religion = religion_wilderness
		#		  culture = culture_wilderness
		#		  female = no
		#		  age = 4000
		#		  trait = wilderness
		#		}
		#		county = {
		#			new_character = {
		#				usurp_title = PREV
		#				set_defacto_liege = THIS
		#				capital = PREV
		#			}
		#			convert_to = CASTLE
		#			new_character = {
		#				set_government_type = feudal_government
		#			}
		#		}
		#		culture = culture_wilderness
		#		religion = religion_wilderness
		#	}
		#}
	
		# destroy the wilderness barony and usurp the county
		hidden_tooltip = {
			FROM = {
				capital_holding = {
					destroy_settlement = THIS
					location = {
						culture = ROOT
						religion = ROOT
					}
				}
			}
		}
		
		usurp_title = { target = ROOT type = invasion }
		
		# finally, abandon the old capital and move to the new one
		hidden_tooltip = {
			create_character = {
			  random_traits = no
			  name = "Wilderness"
			  religion = religion_wilderness
			  culture = culture_wilderness
			  dynasty = 19013
			  female = no
			  age = 4000
			  trait = wilderness
			  #disallow_random_traits = yes
			}
			ROOT = {
				capital_holding = {
					county = {
						new_character = {
							usurp_title = PREV
							set_defacto_liege = THIS
							capital = PREV
						}
						convert_to = CASTLE
						new_character = {
							set_government_type = feudal_government
						}
						location = {
							culture = culture_wilderness
							religion = religion_wilderness
						}
					}
				}
				capital = PREV # set the new capital
			}
		}
	}

	on_fail = {
		ROOT = { 
			prestige = -50
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = {
		factor = 1
	}
}

abandon_realm_resettle_wilderness = { # TODO: abandon all currently occupied counties, not just the capital
	name = CB_NAME_ABANDON_REALM_WILDERNESS
	war_name = WAR_NAME_ABANDON_REALM_WILDERNESS
	sprite = 9
	truce_days = 1825
	is_permanent = yes
#	check_de_jure_tier = COUNT # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	apply_short_occ_mod = no
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
#	press_claim = yes
	can_ask_to_join_war = no
	allow_distant = yes
	infamy_modifier = 0.0

	can_use_gui = {
		ROOT = {
			prestige = 100
		}
	}
	on_add = {
		ROOT = {
			prestige = -100
		}
	}
	
	can_use = {
		ROOT = {
			NOT = { government = nomadic_government }
		}
		FROM = {
			religion_group = religion_group_wilderness
		}
		OR = { # players can do what we want, but the AI should only abandon the realm when told to
			ROOT = { ai = no }
			AND = {
				FROM = { has_character_flag = settle_me }
				ROOT = { has_character_flag = abandon_realm }
			}
		}
		NOT = { # player might be restricted from resettling
			ROOT = { has_character_flag = no_settling }
		}
	}

	can_use_title = {
		tier = COUNT
	}
	
	is_valid = {
		always = yes
	}
	
	on_success = {
		FROM = { clr_character_flag = settle_me }
		ROOT = { clr_character_flag = abandon_realm }
	}

	on_success_title = {
	
		#ROOT = {
		#	# abandon any lands without holdings TODO: with holdings as well, they become ruins and you get a little gold
		#	any_demesne_province = {
		#		limit = {
		#			num_of_settlements = 0
		#		}
		#		create_character = {
		#		  random_traits = no
		#		  name = "Wilderness"
		#		  religion = religion_wilderness
		#		  culture = culture_wilderness
		#		  female = no
		#		  age = 4000
		#		  trait = wilderness
		#		}
		#		county = {
		#			new_character = {
		#				usurp_title = PREV
		#				set_defacto_liege = THIS
		#				capital = PREV
		#			}
		#			convert_to = CASTLE
		#			new_character = {
		#				set_government_type = feudal_government
		#			}
		#		}
		#		culture = culture_wilderness
		#		religion = religion_wilderness
		#	}
		#}
	
		hidden_tooltip = {
			ROOT = {
				# take our wealth with us, to rebuild with later
				scaled_wealth = 4.0

				# ruin and depopulate all demesne provinces
				any_demesne_title = {
					limit = {
						tier = COUNT
					}
					location = {
						ruin_province = yes
						remove_province_modifier = depopulated_2
						remove_province_modifier = depopulated_1
						remove_province_modifier = prosperity_modifier_1
						remove_province_modifier = prosperity_modifier_2
						remove_province_modifier = prosperity_modifier_3
						add_province_modifier = { name = depopulated_3 duration = -1 }
					}
				}
			}

			# usurp the wilderness county
			FROM = {
				capital_holding = {
					location = {
						culture = ROOT
						religion = ROOT
						add_province_modifier = {
							name = settled_by_refugees
							duration = 3650
						}
						remove_province_modifier = depopulated_3
						remove_province_modifier = depopulated_2
						remove_province_modifier = depopulated_1
					}
				}
			}
			
			usurp_title = { target = ROOT type = invasion }			

			# destroy old capital province
			create_character = {
				random_traits = no
				name = "Wilderness"
				religion = religion_wilderness
				culture = culture_wilderness
				dynasty = 19013
				female = no
				age = 4000
				trait = wilderness
				#disallow_random_traits = yes
			}

			# destroy the old kingdom
			ROOT = {
				capital_holding = {
					county = {
						new_character = {
							usurp_title = PREV
							set_defacto_liege = THIS
							capital = PREV
						}
						convert_to = CASTLE
						new_character = {
							set_government_type = feudal_government
						}
						location = {
							culture = culture_wilderness
							religion = religion_wilderness
						}
					}
				}
			
				# destroy all higher titles
				any_demesne_title = {
					limit = {
						higher_tier_than = count
					}
					destroy_landed_title = THIS
				}
			}
		}
	}

	on_fail = {
		ROOT = { 
			prestige = -50
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = {
		factor = 1
	}
}


#wilderness = {
#	name = CB_NAME_WILDERNESS
#	war_name = WAR_NAME_WILDERNESS
#	sprite = 9
#	truce_days = 1825
#	is_permanent = yes
##	check_de_jure_tier = COUNT # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
#	apply_short_occ_mod = no
#	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
##	press_claim = yes
#	can_ask_to_join_war = no
#	allow_distant = yes
#
#	can_use_gui = {
#		ROOT = {
#			war = no
#			OR = {
#				AND = { # restrict nomads and edain less
#					prestige = 200
#					wealth = 10
#					OR = {
#						government = nomadic_government
#						culture_group = culture_group_edain
#						culture_group = culture_group_easterling
#						culture_group = culture_group_forodwaith
#					}
#				}
#				AND = {
#					prestige = 300
#					wealth = 60
#				}
#			}
#		}
#	}
#	on_add = {
#		ROOT = {
#			if = {
#				limit = {
#					NOR = {
#						government = nomadic_government
#						culture_group = culture_group_edain
#						culture_group = culture_group_easterling
#						culture_group = culture_group_forodwaith
#					}
#				}
#				prestige = -300
#				wealth = -60
#			}
#			if = {
#				limit = {
#					OR = {
#						government = nomadic_government
#						culture_group = culture_group_edain
#						culture_group = culture_group_easterling
#						culture_group = culture_group_forodwaith
#					}
#				}
#				prestige = -200
#				wealth = -10
#			}
#			
#			location = {
#				ROOT = {
#					spawn_unit = {
#						earmark = settler_unit
#						owner = THIS
#						province = PREV
#						home = PREV
#						troops = {
#							light_infantry = { 100 100 }
#						}
#					}
#				}
#			}
#		}
#	}
#	
#	can_use = {
#		ROOT = {
#			OR = {
#				ai = no # only some elves should be land grabbing, else they get overzealous
#				has_character_flag = flag_expanding
#				government = nomadic_government
#				culture_group = culture_group_edain
#				culture_group = culture_group_easterling
#				culture_group = culture_group_forodwaith
#			}
#		}
#		FROM = {
#			religion_group = religion_group_wilderness
#			location = {
#				NOT = { culture = culture_mountains }
#			}
#		}
#	}
#
#	can_use_title = {
#		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
#		
#		tier = COUNT
#		
#		any_direct_de_jure_vassal_title = {
#			OR = {
#				holder_scope = {
#					OR = {
#						character = ROOT
#						is_liege_or_above = ROOT
#					}
#				}
#				location = {
#					any_neighbor_province = {
#						OR = {
#							AND = {
#								has_owner = yes
#								owner = {
#									OR = {
#										character = ROOT
#										is_liege_or_above = ROOT
#									}
#								}
#							}
#							AND = {
#								is_land = no
#								OR = {
#									year = 1100
#									ROOT = { religion_group = religion_group_wilderness }
#									FROM = { religion_group = religion_group_wilderness }
#								}
#								any_neighbor_province = {
#									OR = {
#										AND = {
#											has_owner = yes
#											owner = {
#												OR = {
#													character = ROOT
#													is_liege_or_above = ROOT
#												}
#											}
#										}
#										AND = {
#											is_land = no
#											any_neighbor_province = {
#												owner = {
#													OR = {
#														character = ROOT
#														is_liege_or_above = ROOT
#													}
#												}
#											}
#										}
#									}
#								}
#							}
#						}
#					}
#				}
#			}
#		}
#	}
#
#	is_valid = {
#		ROOT = { has_earmarked_regiments = settler_unit } # if you disband these or they die, cannot settle
#	}
#	
#	on_success_title = {
#		# destroy the wilderness barony and usurp the county
#		hidden_tooltip = {	
#			FROM = {
#				capital_holding = {
#					destroy_settlement = THIS
#					location = {
#						culture = ROOT
#						religion = ROOT
#					}
#				}
#			}	
#		}
#		usurp_title = { target = ROOT type = invasion }
#	}
#
#	on_success ={
#		ROOT = {
#			disband_event_forces = settler_unit
#			hidden_tooltip = { character_event = { id = RIP.11700 } } # update prosperity as people move around
#		}
#	}
#	
#	on_fail = {
#		ROOT = {
#			prestige = -100
#			disband_event_forces = settler_unit
#		}
#	}
#
#	attacker_ai_victory_worth = {
#		factor = -1 # always accept
#	}
#	
#	attacker_ai_defeat_worth = {
#		factor = 100
#	}
#
#	defender_ai_victory_worth = {
#		factor = -1 # always accept
#	}
#	
#	defender_ai_defeat_worth = {
#		factor = 100
#	}
#}